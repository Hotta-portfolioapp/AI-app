<!-- ðŸ’¡ ã‚³ãƒ³ãƒ†ãƒŠã§å¹…åˆ¶é™ -->
<div class="container-xl mt-4">
  <div class="knowhows-list row row-cols-1 row-cols-md-3 g-5">
    <% @knowhows.each do |knowhow| %>
      <div class="col">
        <div class="card card-custom-border h-100 overflow-hidden position-relative">
          <!-- âœ… ã‚«ãƒ¼ãƒ‰å…¨ä½“ã‚’ãƒªãƒ³ã‚¯ã§è¦†ã† -->
          <%= link_to knowhow_path(knowhow), class: "stretched-link" do %><% end %>

          <% if knowhow.media_files.attached? %>
            <% primary_file = knowhow.media_files.first %>
            <% if primary_file.image? %>
              <%= image_tag url_for(primary_file), class: "card-img-top aspect-ratio-16x9", style: "object-fit: cover;" %>
            <% elsif primary_file.video? %>
              <video controls class="card-img-top aspect-ratio-16x9" style="object-fit: cover;">
                <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
              </video>
            <% elsif primary_file.audio? %>
              <div class="p-3">
                <audio controls class="w-100">
                  <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                </audio>
              </div>
            <% end %>
          <% end %>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold mb-2">
              <span><%= knowhow.title %></span>
            </h5>

            <!-- èª¬æ˜Žæ–‡ã‚’2è¡Œã«åˆ¶é™ -->
            <p class="card-text small text-muted description-fixed">
              <%= knowhow.description %>
            </p>

            <div class="mt-auto">
              <ul class="list-unstyled small mb-2">
                <li>ã‚«ãƒ†ã‚´ãƒª: <%= t("enum.knowhow.category_type.#{knowhow.category_type}") %></li>
                <li>ä¾¡æ ¼: Â¥<%= knowhow.price %></li>
                <li>æŠ•ç¨¿è€…:
                  <%= link_to(
                        knowhow.user.name || knowhow.user.email,
                        knowhows_path(q: { user_name_or_user_email_cont: knowhow.user.name || knowhow.user.email }),
                        class: "position-relative z-1"
                      ) %>
                </li>
              </ul>

              <% if knowhow.tags.any? %>
                <div class="mb-2">
                  <% knowhow.tags.each do |tag| %>
                    <%= link_to(
                          "##{tag.name}",
                          knowhows_path(q: { tags_name_cont: tag.name }),
                          class: "badge bg-secondary me-1 position-relative z-1"
                        ) %>
                  <% end %>
                </div>
              <% end %>

<% if current_user && knowhow.purchases.exists?(user_id: current_user.id) %>
  <% chat_room = knowhow.chat_room %>

  <% if chat_room.present? %>
    <%= link_to(
          "ãƒãƒ£ãƒƒãƒˆã™ã‚‹",
          chat_room_path(chat_room),
          class: "btn btn-outline-primary btn-sm position-relative z-1",
          data: { turbo: false }
        ) %>
  <% end %>
<% end %>

            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
