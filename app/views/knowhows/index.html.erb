<%= link_to "新規登録", new_knowhow_path, class: "btn btn-primary mb-3" %>

<%= search_form_for @q, url: knowhows_path, method: :get do |f| %>
  <div>
    <%= f.label :title_cont, "タイトルに含む" %>
    <%= f.search_field :title_cont %>
  </div>

<div>
  <%= f.label :user_name_or_user_email_cont, "投稿者名またはEmail" %>
  <%= f.search_field :user_name_or_user_email_cont %>
</div>

<div>
  <%= f.label :category_eq, "カテゴリ" %>
  <%# `category_eq` は「categoryが選択値と完全に一致する」という検索条件 %>
  <%= f.select :category_eq, 
                options_for_select(Knowhow.category_types.keys.map { |k| [t("enum.knowhow.category_type.#{k}"), k] } @q.category_eq), 
                { include_blank: 'すべて' } %>
</div>

  <div>
    <%= f.submit "検索" %>
  </div>
<% end %>

<div class="knowhows-list mt-4">
  <% @knowhows.each do |knowhow| %>
    <div class="knowhow-card border p-3 mb-4 rounded">
      <% if knowhow.media_files.attached? %>
        <div class="media-scroll-container mb-2">
          <% knowhow.media_files.each do |file| %>
            <div class="media-item">
              <% if file.image? %>
                <%= image_tag url_for(file), class: "img-fluid knowhow-media-image" %>
              <% elsif file.video? %>
                <video controls class="knowhow-media-video">
                  <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
                </video>
              <% elsif file.audio? %>
                <video controls class="knowhow-media-video">
                  <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
                </audio>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <h3><%= link_to knowhow.title, knowhow %></h3>
      <p><%= truncate(knowhow.description, length: 80) %></p>
      <p>価格: ¥<%= knowhow.price %></p>
      <p>投稿者: <%= knowhow.user.name || knowhow.user.email %></p>
    </div>
  <% end %>
</div>
