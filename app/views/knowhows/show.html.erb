<% if @knowhow.media_files.attached? %>
  <div class="container px-3"> <!-- ‰∏≠Â§ÆÊèÉ„ÅàÁî®„Ç≥„É≥„ÉÜ„Éä -->
    <div class="d-flex flex-column flex-md-row gap-4 mb-4 justify-content-center">

      <!-- Â∑¶Ôºö„Çµ„É†„Éç„Ç§„É´‰∏ÄË¶ß -->
      <div class="d-flex flex-md-column gap-2">
        <% @knowhow.media_files.each_with_index do |file, index| %>
          <div onmouseover="showMedia(<%= index %>)" class="thumbnail-box" style="width: 60px; height: 60px;">
            <% if file.image? %>
              <%= image_tag url_for(file), style: "width: 100%; height: 100%; object-fit: cover;" %>
            <% elsif file.video? %>
              <div style="width: 100%; height: 100%; background: #000; color: #fff; display: flex; align-items: center; justify-content: center;">
                üé•
              </div>
            <% elsif file.audio? %>
              <div style="width: 100%; height: 100%; background: #eee; display: flex; align-items: center; justify-content: center;">
                üéß
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- ‰∏≠Â§ÆÔºöÈÅ∏Êäû„Åï„Çå„Åü„É°„Éá„Ç£„Ç¢ -->
      <div class="flex-grow-1 me-md-4" style="max-width: 600px;">
        <% @knowhow.media_files.each_with_index do |file, index| %>
          <div id="media-<%= index %>" class="main-media" style="<%= index == 0 ? '' : 'display: none;' %>">
            <% if file.image? %>
              <%= image_tag url_for(file), class: "img-fluid rounded w-100" %>
            <% elsif file.video? %>
              <video controls class="w-100 rounded">
                <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
              </video>
            <% elsif file.audio? %>
              <audio controls class="mt-2 w-100">
                <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
              </audio>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Âè≥ÔºöË©≥Á¥∞ÊÉÖÂ†± -->
      <div class="flex-grow-1 ms-md-3" style="max-width: 500px;">
        <h1 class="fw-bold fs-4 mb-3 text-start"><%= @knowhow.title %></h1>
        <p class="lead mb-4"><%= @knowhow.description %></p>

        <ul class="list-unstyled mb-4">
          <li><strong>„Ç´„ÉÜ„Ç¥„É™:</strong> <%= t("enum.knowhow.category_type.#{@knowhow.category_type}") %></li>
          <li><strong>‰æ°Ê†º:</strong> ¬•<%= @knowhow.price %></li>
          <li><strong>ÊäïÁ®øËÄÖ:</strong>
            <%= link_to (@knowhow.user.name || @knowhow.user.email),
                  knowhows_path(q: { user_name_or_user_email_cont: @knowhow.user.name || @knowhow.user.email }) %>
          </li>
        </ul>

        <% if @knowhow.tags.any? %>
          <div class="mb-3">
            <% @knowhow.tags.each do |tag| %>
              <%= link_to "##{tag.name}", knowhows_path(q: { tags_name_cont: tag.name }),
                    class: "badge bg-secondary me-1" %>
            <% end %>
          </div>
        <% end %>

        <% if @knowhow.user != current_user %>
          <% if @purchased && @purchase.knowhow.chat_room.present? %>
            <%= link_to "„ÉÅ„É£„ÉÉ„Éà„Å∏", knowhow_chat_room_path(@knowhow, @purchase.knowhow.chat_room),
                  class: "btn btn-primary me-2" %>
          <% else %>
            <%= link_to "Ë≥ºÂÖ•„Åô„Çã", new_knowhow_purchase_path(@knowhow),
                  class: "btn btn-success me-2" %>
          <% end %>
        <% else %>
          <p class="text-muted mb-3">‚Äª„Åì„Çå„ÅØ„ÅÇ„Å™„Åü„ÅÆÊäïÁ®ø„Åß„Åô„ÄÇ</p>
          <div class="d-flex gap-2">
            <%= link_to 'Á∑®ÈõÜ', edit_knowhow_path(@knowhow), class: "btn btn-secondary" %>
            <%= link_to 'ÂâäÈô§', knowhow_path(@knowhow),
                  data: { turbo_method: :delete, turbo_confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' },
                  class: "btn btn-danger" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<%= javascript_include_tag "knowhows/show", "data-turbo-track": "reload", defer: true %>
