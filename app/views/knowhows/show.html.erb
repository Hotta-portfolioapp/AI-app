<h1><%= @knowhow.title %></h1>

<% if @knowhow.media_files.attached? %>
  <% @knowhow.media_files.each do |file| %>
    <% if file.image? %>
      <%= image_tag url_for(file), width: 400 %>
    <% elsif file.video? %>
      <video width="400" controls>
        <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
      </video>
    <% elsif file.audio? %>
      <audio controls>
        <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
      </audio>
    <% end %>
  <% end %>
<% end %>

<p><%= @knowhow.description %></p>
<p>カテゴリ: <%= t("enum.knowhow.category_type.#{@knowhow.category_type}") %></p>
<p>価格: ¥<%= @knowhow.price %></p>
<p>投稿者: 
  <%= link_to (@knowhow.user.name || @knowhow.user.email), knowhows_path(q: { user_name_or_user_email_cont: @knowhow.user.name || @knowhow.user.email }) %>
</p>

<% if @knowhow.tags.any? %>
  <p>タグ: 
    <% @knowhow.tags.each do |tag| %>
      <%= link_to "##{tag.name}", knowhows_path(q: { tags_name_cont: tag.name }), class: "badge bg-secondary me-1" %>
    <% end %>
  </p>
<% end %>

<% if @knowhow.user != current_user %>
  <% if @purchased && @purchase.chat_room.present? %>
    <%= link_to "チャットへ", knowhow_chat_room_path(@knowhow, @purchase.chat_room), class: "btn btn-primary" %>
  <% else %>
    <%= link_to "購入する", new_knowhow_purchase_path(@knowhow), class: "btn btn-success" %>
  <% end %>
<% else %>
  <p class="text-muted">※これはあなたの投稿です。</p>
  <%= link_to '編集', edit_knowhow_path(@knowhow), class: "btn btn-secondary me-2" %>
  <%= link_to '削除', knowhow_path(@knowhow),
        data: { turbo_method: :delete, turbo_confirm: '本当に削除しますか？' },
        class: "btn btn-danger" %>
<% end %>
