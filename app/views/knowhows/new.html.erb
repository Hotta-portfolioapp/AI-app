<%= form_with model: @knowhow, local: true, multipart: true do |f| %>
  <div class="container">

    <!-- „É°„Ç§„É≥2„Ç´„É©„É† -->
    <div class="row">
      <!-- Â∑¶„Ç´„É©„É† -->
      <div class="col-md-6">
        <!-- „Çµ„É†„Éç -->
        <div class="mb-3 text-center border p-4">
          <div>üì∏</div>
          <div>„Çµ„É†„Éç</div>
        </div>

        <!-- „Ç´„ÉÜ„Ç¥„É™ -->
        <div class="mb-3">
          <%= f.label :category_type, "„Ç´„ÉÜ„Ç¥„É™" %>
          <%= f.select :category_type,
              Knowhow.category_types.keys.map { |k| [t("enum.knowhow.category_type.#{k}"), k] },
              { include_blank: "ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ" },
              class: "form-select" %>
        </div>

        <!-- ‰æ°Ê†º -->
        <div class="mb-3">
          <%= f.label :price %>
          <%= f.number_field :price, class: "form-control" %>
        </div>
      </div>

      <!-- Âè≥„Ç´„É©„É† -->
      <div class="col-md-6">
        <!-- „Çø„Ç§„Éà„É´ -->
        <div class="mb-3">
          <%= f.label :title %>
          <%= f.text_field :title, class: "form-control" %>
        </div>

        <!-- „Çø„Ç∞ -->
        <div class="mb-3">
          <%= f.label :tag_list, "„Çø„Ç∞ („Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅßÂÖ•Âäõ)" %>
          <%= f.text_field :tag_list, value: @knowhow.tags.map(&:name).join(','), class: "form-control" %>
        </div>

        <!-- Ë™¨Êòé -->
        <div class="mb-3">
          <%= f.label :description %>
          <%= f.text_area :description, class: "form-control", rows: 5 %>
        </div>
      </div>
    </div>

    <!-- ‚úÖ ‰Ωú„ÇäÊñπ„Çª„ÇØ„Ç∑„Éß„É≥ -->
    <h3 class="mt-4">‰Ωú„ÇäÊñπ</h3>
    <div id="instructions" class="d-flex flex-wrap gap-3">
      <%= f.fields_for :instructions do |instruction_form| %>
        <!-- ‰ΩøÁî®„ÇΩ„Éï„Éà -->
        <div class="mb-2">
          <%= instruction_form.label :software, "‰ΩøÁî®„ÇΩ„Éï„Éà" %>
          <%= instruction_form.text_field :software, class: "form-control", placeholder: "‰æã: Photoshop, Premiere" %>
        </div>

        <div class="instruction-block card position-relative shadow-sm p-3" style="width: 240px;">
          <!-- „Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑ -->
          <div class="step-badge"><%= instruction_form.object.step.presence || "?" %></div>

          <!-- „É°„Éã„É•„Éº -->
          <div class="dropdown step-menu">
            <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              ‚ãØ
            </button>
            <ul class="dropdown-menu">
              <li><button type="button" class="dropdown-item add-step">‰Ωú„ÇäÊñπ„ÇíËøΩÂä†</button></li>
              <li><button type="button" class="dropdown-item remove-step">‰Ωú„ÇäÊñπ„ÇíÂâäÈô§</button></li>
            </ul>
          </div>

          <!-- ÁîªÂÉè -->
          <div class="mb-2 text-center">
            <% if instruction_form.object.image.attached? %>
              <%= image_tag instruction_form.object.image, class: "img-fluid rounded", style: "max-height: 120px;" %>
            <% else %>
              <div class="bg-light rounded" style="height: 120px;"></div>
            <% end %>
            <%= instruction_form.file_field :image, class: "form-control mt-1" %>
          </div>

          <!-- Ë™¨ÊòéÊñá -->
          <%= instruction_form.text_area :description, rows: 2, class: "form-control mb-2", placeholder: "Ë™¨ÊòéÊñá„ÇíÂÖ•Âäõ" %>

          <!-- „Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑ -->
          <%= instruction_form.number_field :step, min: 1, class: "form-control", placeholder: "„Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑" %>
        </div>
      <% end %>
    </div>

    <!-- ÊäïÁ®ø„Éú„Çø„É≥ -->
    <div>
      <%= f.submit "ÊäïÁ®ø„Åô„Çã", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>

<!-- ‚úÖ JS„ÉÜ„É≥„Éó„É¨„Éº„Éà -->
<div id="instruction-template" class="d-none">
  <div class="instruction-block card position-relative shadow-sm p-3" style="width: 240px;">
    <div class="step-badge">NEW_INDEX</div>

    <div class="dropdown step-menu">
      <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        ‚ãØ
      </button>
      <ul class="dropdown-menu">
        <li><button type="button" class="dropdown-item add-step">‰Ωú„ÇäÊñπ„ÇíËøΩÂä†</button></li>
        <li><button type="button" class="dropdown-item remove-step">‰Ωú„ÇäÊñπ„ÇíÂâäÈô§</button></li>
      </ul>
    </div>

    <!-- ÁîªÂÉè -->
    <div class="mb-2 text-center">
      <div class="bg-light rounded" style="height: 120px;"></div>
      <input type="file" name="knowhow[instructions_attributes][NEW_INDEX][image]" class="form-control mt-1">
    </div>

    <!-- Ë™¨ÊòéÊñá -->
    <textarea name="knowhow[instructions_attributes][NEW_INDEX][description]" class="form-control mb-2" rows="2" placeholder="Ë™¨ÊòéÊñá„ÇíÂÖ•Âäõ"></textarea>

    <!-- „Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑ -->
    <input type="number" name="knowhow[instructions_attributes][NEW_INDEX][step]" class="form-control" min="1" placeholder="„Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑">
  </div>
</div>
