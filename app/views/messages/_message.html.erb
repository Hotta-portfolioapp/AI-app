<% user = local_assigns[:current_user_loc] || current_user %>

<div class="d-flex mb-3 <%= message.user == user ? 'justify-content-end' : 'justify-content-start' %>">
  <div class="flex-shrink-0">
    <% if message.user.avatar.attached? %>
      <% avatar_url = url_for(message.user.avatar.variant(resize_to_fill: [40, 40])) %>
      <%= image_tag avatar_url,
                    alt: message.user.name,
                    class: "rounded-circle",
                    style: "width: 40px; height: 40px; object-fit: cover;" %>
    <% else %>
      <%= image_tag 'default_avatar.png',
                    alt: message.user.name,
                    class: "rounded-circle border border-white bg-white",
                    style: "width: 40px; height: 40px; object-fit: cover;" %>
    <% end %>
  </div>

  <div class="<%= message.user == user ? 'text-dark' : 'bg-light' %> 
              rounded-4 px-3 py-2 mx-2 shadow-sm position-relative"
       style="max-width: 75%; display: inline-block;
              background-color: <%= message.user == user ? '#dcf8c6' : '#f8f9fa' %>;">
    <p class="mb-0 d-inline-block" style="padding-right: 2.5em; color: black;">
      <%= message.content %>
    </p>
    <small class="text-muted position-absolute bottom-0 end-0 me-2 mb-1"
           style="font-size: 0.75rem;">
      <%= message.created_at.strftime("%H:%M") %>
    </small>
  </div>
</div>
