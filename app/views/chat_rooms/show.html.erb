<div id="chat-room" data-room-id="<%= @chat_room.id %>"></div>

<!-- ðŸ’¬ ãƒãƒ£ãƒƒãƒˆå…¨ä½“ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ä¸‹ã‹ã‚‰å›ºå®š -->
<div class="chat-wrapper d-flex flex-column position-fixed start-0 w-100" 
<%# height: calc(100vh - 90px)ï¼šå…¨ä½“ã‹ã‚‰90pxåˆ†å¼•ã„ãŸåˆ†ã§æ®‹ã‚Šã‚’æ§‹æˆã™ã‚‹ %>
     style="top: 90px; height: calc(100vh - 90px); z-index: 1; background: #f8f9fa;">

  <!-- âœ… å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒãƒ£ãƒƒãƒˆç›¸æ‰‹æƒ…å ±ï¼‰ -->
  <div class="chat-header d-flex align-items-center justify-content-center border-bottom bg-white px-3 py-2" style="flex: 0 0 auto;">
    <div class="d-flex align-items-center">
      <% if @chat_partner.avatar.attached? %>
        <%= image_tag @chat_partner.avatar, class: "rounded-circle me-2", style: "width: 40px; height: 40px; object-fit: cover;" %>
      <% else %>
        <div class="rounded-circle border" 
            style="width: 40px; height: 40px; overflow: hidden; background-color: white; border-color: black; border-width: 1px; border-style: solid;">
          <%= image_tag 'default_avatar.png',
                style: "width: 55px; height: 55px; object-fit: cover; margin-left: -7.5px; margin-top: -5px;" %>
        </div>
      <% end %>
      <div class="ms-1">
        <strong><%= @chat_partner.name %></strong><br>
        <small class="text-muted">@<%= @chat_partner.name %></small>
      </div>
    </div>
  </div>

  <!-- âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰ -->
  <%# flex-grow-1 ï¼šã€Œæ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä¼¸ã°ã™ã€ã®ã¯ ã¾ã ç¢ºä¿ã•ã‚Œã¦ã„ãªã„ã‚¹ãƒšãƒ¼ã‚¹ ã®ã¿ %>
 <div id="messages" class="flex-grow-1 px-3 py-2 overflow-auto d-flex flex-column" style="scroll-behavior: smooth;">
    <%= render partial: "messages/grouped_messages", locals: { messages: @messages } %>
  </div>

  <!-- âœ… å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆä¸‹éƒ¨å›ºå®šï¼‰ -->
<%# flex: 0 0 autoï¼šå†…å®¹ã®é«˜ã•ã«å¾“ã£ã¦è‡ªå‹•ã§æ±ºã¾ã‚‹ %>
  <div class="chat-input bg-white border-top p-3" style="flex: 0 0 auto;">
    <%= form_with model: [@chat_room, Message.new], local: false, html: { id: "message_form", class: "d-flex align-items-center gap-2" } do |f| %>
      <%= f.text_area :content, rows: 1, placeholder: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...", 
            class: "form-control flex-grow-1 rounded-pill px-3", style: "resize: none;" %>
      <%= f.submit "é€ä¿¡", class: "btn btn-dark rounded-pill px-4" %>
    <% end %>
  </div>
</div>


<%# [è¦ªé«˜ã•: calc(100vh-90px)]
+-------------------------+
| #messages (flex-grow-1) | â† æ®‹ã‚Šã®é«˜ã•ã ã‘ä¼¸ã³ã‚‹
|                         |
|                         |
+-------------------------+
| .chat-input (flex:0 0 auto) | â† é«˜ã•å›ºå®š
+-------------------------+ %>
