<div class="container-fluid">
  <div class="row min-vh-100">

    <!-- ✅ 左カラム：サイドメニュー -->
    <div class="col-md-3 bg-light p-4 border-end">
      <% menu_items = [
        { text: "プロフィールを編集する", path: edit_user_path(current_user) },
        { text: "アカウントを編集する", path: edit_user_registration_path },
        { text: "お支払い情報", path: "#" },
        { text: "購入履歴", path: "#" }
      ] %>

      <% menu_items.each do |item| %>
        <div class="p-3 mb-3 border rounded shadow-sm bg-white menu-box">
          <%= link_to item[:text], item[:path], class: "text-decoration-none text-dark fw-bold d-block" %>
        </div>
      <% end %>
    </div>

    <!-- ✅ 右カラム：ノウハウ一覧 -->
    <div class="col-md-9 bg-light p-4">
      <% if @posted_knowhows.any? %>
        <h2 class="fw-bold mb-4 text-center">自分のノウハウ投稿一覧</h2>
        <div class="row row-cols-2 row-cols-md-3 row-cols-xl-4 g-3">
          <% @posted_knowhows.each do |knowhow| %>
            <div class="col">
              <div class="card h-100 shadow-sm overflow-hidden position-relative">

                <!-- カード全体をリンクに -->
                <%= link_to knowhow_path(knowhow), class: "stretched-link" do %><% end %>

                <% if knowhow.media_files.attached? %>
                  <% primary_file = knowhow.media_files.first %>
                  <% if primary_file.image? %>
                    <%= image_tag url_for(primary_file), class: "card-img-top aspect-ratio-16x9", style: "object-fit: cover;" %>
                  <% elsif primary_file.video? %>
                    <video controls class="card-img-top aspect-ratio-16x9" style="object-fit: cover;">
                      <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                    </video>
                  <% elsif primary_file.audio? %>
                    <div class="p-3">
                      <audio controls class="w-100">
                        <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                      </audio>
                    </div>
                  <% end %>
                <% end %>

                <div class="card-body d-flex flex-column">
                  <h5 class="card-title fw-bold mb-2"><%= knowhow.title %></h5>

                  <p class="card-text small text-muted description-fixed">
                    <%= knowhow.description %>
                  </p>

                  <div class="mt-auto">
                    <ul class="list-unstyled small mb-2">
                      <li>カテゴリ: <%= t("enum.knowhow.category_type.#{knowhow.category_type}") %></li>
                      <li>価格: ¥<%= knowhow.price %></li>
                      <li>投稿日: <%= l(knowhow.created_at, format: :short) %></li>
                    </ul>

                    <% if knowhow.tags.any? %>
                      <div class="mb-2">
                        <% knowhow.tags.each do |tag| %>
                          <%= link_to(
                                "##{tag.name}",
                                knowhows_path(q: { tags_name_cont: tag.name }),
                                class: "badge bg-secondary me-1 position-relative z-1"
                              ) %>
                        <% end %>
                      </div>
                    <% end %>

                    <% if current_user && (knowhow.user_id == current_user.id || knowhow.purchases.exists?(user_id: current_user.id)) %>
                      <%= link_to(
                            "チャットする",
                            chat_room_path(knowhow.chat_room),
                            class: "btn btn-outline-primary btn-sm position-relative z-1",
                            data: { turbo: false }
                          ) %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center mt-5">
          <p>投稿したノウハウはありません。</p>
        </div>
      <% end %>
    </div>

  </div>
</div>
