<section>
  <% if @posted_knowhows.any? %>
    <div class="container-xl mt-4">
        <h2 class="mt-5  fw-bold ">自分の投稿ノウハウ一覧</h3>
      <div class="row row-cols-1 row-cols-md-3 g-5 mt-1">
        <% @posted_knowhows.each do |knowhow| %>
          <div class="col">
            <div class="card h-100 shadow-sm overflow-hidden position-relative">

              <!-- カード全体をリンクに -->
              <%= link_to knowhow_path(knowhow), class: "stretched-link" do %><% end %>

              <% if knowhow.media_files.attached? %>
                <% primary_file = knowhow.media_files.first %>
                <% if primary_file.image? %>
                  <%= image_tag url_for(primary_file), class: "card-img-top aspect-ratio-16x9", style: "object-fit: cover;" %>
                <% elsif primary_file.video? %>
                  <video controls class="card-img-top aspect-ratio-16x9" style="object-fit: cover;">
                    <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                  </video>
                <% elsif primary_file.audio? %>
                  <div class="p-3">
                    <audio controls class="w-100">
                      <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                    </audio>
                  </div>
                <% end %>
              <% end %>

              <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold mb-2"><%= knowhow.title %></h5>

                <p class="card-text small text-muted description-fixed">
                  <%= knowhow.description %>
                </p>

                <div class="mt-auto">
                  <ul class="list-unstyled small mb-2">
                    <li>カテゴリ: <%= t("enum.knowhow.category_type.#{knowhow.category_type}") %></li>
                    <li>価格: ¥<%= knowhow.price %></li>
                    <li>投稿日: <%= l(knowhow.created_at, format: :short) %></li>
                  </ul>

                  <% if knowhow.tags.any? %>
                    <div class="mb-2">
                      <% knowhow.tags.each do |tag| %>
                        <%= link_to(
                              "##{tag.name}",
                              knowhows_path(q: { tags_name_cont: tag.name }),
                              class: "badge bg-secondary me-1 position-relative z-1"
                            ) %>
                      <% end %>
                    </div>
                  <% end %>

                  <% if current_user && (knowhow.user_id == current_user.id || knowhow.purchases.exists?(user_id: current_user.id)) %>
                    <%= link_to(
                          "チャットする",
                          chat_room_path(knowhow.chat_room),
                          class: "btn btn-outline-primary btn-sm position-relative z-1",
                          data: { turbo: false }
                        ) %>
                  <% end %>
                </div>
              </div>

            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <p>投稿したノウハウはありません。</p>
  <% end %>
</section>
