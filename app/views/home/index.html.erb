<div class="hero-section d-flex justify-content-center align-items-center text-center"
     style="background-image: url('<%= asset_path('MV.jpg') %>');
            background-size: cover;
            background-position: center;
            width: 100vw;
            height: 92vh;
            color: white;
            position: relative;">

  
  <!-- 横並びコンテンツ -->
  <div class="position-absolute d-flex gap-2" style="bottom: 250px; right: 320px; z-index: 10;">

    <%= search_form_for @q, url: knowhows_path, method: :get, html: { class: 'd-flex gap-2' } do |f| %>
      
      <!-- 検索入力 -->
      <div class="position-relative flex-grow-1">
        <%= f.search_field :title_or_description_or_user_name_or_user_email_cont,
          placeholder: "探しているもの",
          class: "form-control pe-5",
          id: "search-input",
          autocomplete: "off" %>
      </div>

      <!-- カテゴリ選択 -->
      <div>
        <%= f.select :category_type_eq,
          options_for_select(
            Knowhow.category_types.map { |k, v| [t("enum.knowhow.category_type.#{k}"), v] },
            @q.category_type_eq
          ),
          { include_blank: 'カテゴリなし' },
          { class: "form-select" } %>
      </div>

      <!-- タグ入力 -->
      <div>
        <%= f.search_field :tags_name_cont, placeholder: "タグ名", class: "form-control" %>
      </div>

      <!-- 検索ボタン -->
      <div>
        <%= f.submit "検索", class: "btn btn-primary" %>
      </div>

    <% end %>
  </div>
</div>

<!-- ランダムカード表示 -->
<div class="container-xl mt-4 p-5">
  <h2 class="fw-bold mb-5">おすすめのノウハウ</h2>
  <div class="knowhows-list row row-cols-1 row-cols-md-3 g-5">
    <% @knowhows.each do |knowhow| %>
      <div class="col">
        <div class="card card-custom-border h-100 overflow-hidden position-relative">

          <%= link_to knowhow_path(knowhow), class: "stretched-link" do %><% end %>

          <% if knowhow.media_files.attached? %>
            <% primary_file = knowhow.media_files.first %>
            <% if primary_file.image? %>
              <%= image_tag url_for(primary_file), class: "card-img-top aspect-ratio-16x9", style: "object-fit: cover;" %>
            <% elsif primary_file.video? %>
              <video controls class="card-img-top aspect-ratio-16x9" style="object-fit: cover;">
                <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
              </video>
            <% elsif primary_file.audio? %>
              <div class="p-3">
                <audio controls class="w-100">
                  <source src="<%= url_for(primary_file) %>" type="<%= primary_file.content_type %>">
                </audio>
              </div>
            <% end %>
          <% end %>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold mb-2"><%= knowhow.title %></h5>
            <p class="card-text small text-muted description-fixed"><%= knowhow.description %></p>

            <div class="mt-auto">
              <ul class="list-unstyled small mb-2">
                <li>カテゴリ: <%= t("enum.knowhow.category_type.#{knowhow.category_type}") %></li>
                <li>価格: ¥<%= knowhow.price %></li>
                <li>投稿者:
                  <%= link_to(
                        knowhow.user.name || knowhow.user.email,
                        knowhows_path(q: { user_name_or_user_email_cont: knowhow.user.name || knowhow.user.email })
                      ) %>
                </li>
              </ul>

              <% if knowhow.tags.any? %>
                <div class="mb-2">
                  <% knowhow.tags.each do |tag| %>
                    <%= link_to "##{tag.name}", knowhows_path(q: { tags_name_cont: tag.name }),
                      class: "badge bg-secondary me-1" %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
